<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-emerald-200 flex justify-center items-center rounded-2xl border-2 shadow-xl p-6">
        <div>
            <header>
                <h1 class="text-2xl font-semibold">Todo List</h1>
                <p class="text-gray-500 text-sm mt-1">Add tasks, mark complete, edit, filter and save automatically in your browser.</p>
            </header><br>
            <div>
                <input id="todoinput" type="text" placeholder="What needs to be done? (press Enter to add)" class="border-2 border-b-emerald rounded-lg p-3 text-sm w-full ">
            </div><br>
            <div class="mt-3 flex gap-2">
                <button id="add" class="flex-1 py-2 border border-transparent bg-amber-50 rounded-lg text-sm hover:bg-emerald-400">ADD</button>
                <button id="clear" class="flex-1 py-2 border border-transparent bg-amber-50 rounded-lg text-sm hover:bg-emerald-400">CLEAR</button>
            </div><br>
            <div>
                <button data-filter="all" class="px-3 py-1 rounded-lg text-sm border border-transparent bg-blue-50">All</button>
                <button data-filter="active" class="px-3 py-1 rounded-lg text-sm border border-transparent text-gray-600">Active</button>
                <button data-filter="completed" class="px-3 py-1 rounded-lg text-sm border border-transparent text-gray-600">Completed</button>
            </div><br>
            <div class="ml-auto text-sm text-gray-500" id="count">0 items</div>
            <div>
                <ul id="todolist"></ul>
            </div><br>
            <div id="empty" class="text-center">
                No todos yet, add one above
            </div>
        </div>
    </div>

<script>
const input = document.getElementById('todoinput');
const addBtn = document.getElementById('add');
const listEl = document.getElementById('todolist');
const filters = document.querySelectorAll('[data-filter]');
const countEl = document.getElementById('count');
const clearBtn = document.getElementById('clear');
const emptyEl = document.getElementById('empty');

var todos = [];
var filter = 'all';
const key = 'tod';

function save(){
    localStorage.setItem(key, JSON.stringify(todos));
}
function load(){
    const raw = localStorage.getItem(key); 
    if(raw){
        todos = JSON.parse(raw);
    } else {
        todos = [];
    }
}
function render(){
    listEl.innerHTML = '';
    const visible = todos.filter(t => {
        if (filter === 'active') return !t.done;
        if (filter === 'completed') return t.done;
        return true;
    });
    emptyEl.classList.toggle('hidden', visible.length !== 0);
    visible.forEach(t => {
        const li = document.createElement('li');
        li.className = "flex items-center gap-3 py-2";
        if (t.done) li.classList.add("opacity-60", "line-through");

        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.checked = !!t.done;
        cb.className = "h-4 w-4 border-gray-300 rounded";
        cb.addEventListener('change', () => {
            t.done = cb.checked;
            save();
            render();
        });

        const txt = document.createElement('div');
        txt.className = "flex-1 text-sm";
        txt.textContent = t.text;
        txt.addEventListener('dblclick', () => startEdit(t, txt));

        const actions = document.createElement('div');
        actions.className = "flex gap-2";

        const editBtn = document.createElement('button');
        editBtn.className = "text-xs";
        editBtn.textContent = 'Edit';
        editBtn.addEventListener('click', () => startEdit(t, txt));

        const delBtn = document.createElement('button');
        delBtn.className = "text-red-500 text-xs";
        delBtn.textContent = 'Delete';
        delBtn.addEventListener('click', () => {
            todos = todos.filter(x => x.id !== t.id);
            save();
            render();
        });

        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        li.appendChild(cb);
        li.appendChild(txt);
        li.appendChild(actions);
        listEl.appendChild(li);
    });
    countEl.textContent = `${todos.filter(t => !t.done).length} items left`;
    save();
}

function addTodo(text){
    const trimmed = String(text || '').trim();
    if (!trimmed) return;
    todos.push({
        id: Date.now() + Math.floor(Math.random() * 1000),
        text: trimmed,
        done: false
    });
    input.value = '';
    render();
}

function startEdit(todo, textNode){
    const inputEl = document.createElement('input');
    inputEl.type = 'text';
    inputEl.value = todo.text;
    inputEl.className = "flex-1 border rounded px-2 py-1 text-sm";
    textNode.replaceWith(inputEl);
    inputEl.focus();

    function finish(){
        const v = inputEl.value.trim();
        if (v) todo.text = v; else todos = todos.filter(x => x.id !== todo.id);
        render();
    }

    inputEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') finish();
        if (e.key === 'Escape') render();
    });
    inputEl.addEventListener('blur', finish);
}
filters.forEach(btn => btn.addEventListener('click', () => {
filters.forEach(b=>b.classList.remove('bg-amber-50', 'text-emerald-600'));
btn.classList.add('bg-amber-50', 'text-emerald-600');
filter = btn.dataset.filter;
render();
}));

clearBtn.addEventListener('click', () => {
    todos = todos.filter(t => !t.done);
    render();/*When you click Clear,
keep only tasks that are not done,
throw away all done ones,
and redraw the list.*/
});

addBtn.addEventListener('click', () => addTodo(input.value));
input.addEventListener('keydown', (e) => { 
    if (e.key === 'Enter') addTodo(input.value);
 });

load();
render();
</script>
</body>
</html>

